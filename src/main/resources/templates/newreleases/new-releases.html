<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/doc/head :: main-head('New Releases')" />
<body>

<!-- scripts -->
<th:block th:replace="fragments/nav/navbar :: main-navigation" />

<section class="section">
    <h1 class="title">Podcasts</h1>
    <ul>
        <li th:each="episode : ${episodes}">
            <div class="box">
                <article class="media">
                    <figure class="media-left">
                        <p class="image is-64x64">
                            <img th:src="${episode.imageUrl}" th:alt="${episode.imageTitle}">
                        </p>
                    </figure>
                    <div class="media-content">
                        <div class="content">
                            <p class="title is-5">[(${episode.title})]</p>
                            <p th:text="${#temporals.format(episode.publishedDate, 'dd/MMM/yyyy HH:mm')}" class="subtitle is-6"></p>
                        </div>
                        <div class="level">
                            <div class="level-left">
	                            <div class="level-item">
                            		<form th:action="@{/episodes/{episodeId}(episodeId=${episode.id})}" method="POST">
	                                	<div class="field is-grouped">
  											<p class="control">
	                                        	<a class="button" th:href="@{/listen(episodeId=${episode.id})}">Play</a>
  											</p>
	                               			<p class="control">
	                                    		<button type="button" class="button is-danger is-outlined" onclick="window.notInterested();" >Ignore</button>
											</p>	                                  
	                                   	</div>  
                            		</form>
	                        	</div>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
        </li>
    </ul>

</section>

<script type="application/javascript">

    window.notInterested = function(e) {
	    e = e || window.event;
	    
	    e.preventDefault();
	    
	    const $element = e.target || e.srcElement;
	    
	    const $form = $element.form;
	    
	    const $target = $element.closest('li');
	    
	    // Toggle the "is-hidden" class on the parent list element
        $target.classList.toggle('is-hidden');
        
        var token = document.getElementsByName('_csrf')[0].getAttribute('content');
		var header = document.getElementsByName('_csrf_header')[0].getAttribute('content');
        
        var myHeaders = new Headers();
		myHeaders.append(header, token);
        
        fetch( $form.action + '/ignore', {
                        method: 'POST',
                        headers: myHeaders
                    })
                    .then(response => response)
                    .then(data => {
                        console.log('Success:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
		
		return false;
	
	}

</script>

</body>
</html>